<section class="panel">
  <header class="panel__header">
    <span class="hide-mobile">
      <h2><%= @selection_process.full_name %></h2>
    </span>

    <div class="pull-right">
      <% if @selection_process.consolidated? %>
        <span>
          Processo consolidado em
          <%= @selection_process.consolidated_at.strftime("%d/%m/%y %H:%M") %>
        </span>
      <% else %>
        <%= link_to "CONSOLIDAR PROCESSO SELETIVO", selection_process_consolidate_path(@selection_process), :class => "btn--primary", method: :post %>
      <% end %>

      <%= link_to "EDITAR PROCESSO SELETIVO", @selection_process, :class => "btn" %>
    </div>
  </header>

  <hr>
    <%= link_to_function "ADICIONAR ETAPA", "show_process_steps_form()", :class => "btn", :style => "margin-right:20px; float:right" %>
  <h3 style="margin-left:20px">
    Listagem de Etapas
  </h3>
  
  <table class="table">
    <tbody>
      <% @selection_process.process_steps.order(&:order_number).each do |step| %>
        <tr>
          <td>
            <h4>
              <%= step.name %>
            </h4>
            <p><%= truncate(step.description, length: 80) %></p>
          </td>
          <td>
            <%= step.candidates.count == 1 ? "1 Candidato" : "#{step.candidates.count} Candidatos" %>
          </td>
          <td>
            <%= "Abertura: #{step.open_date.strftime("%d/%m/%y %H:%M")}" if step.open_date %><br>
            <%= "Fechamento: #{step.close_date.strftime("%d/%m/%y %H:%M")}" if step.open_date %>
          </td>
          <td>
            <%= link_to "Gerenciar etapa", [@selection_process, step], :class => "btn btn--small" %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
  
  <div id="block_process_step_form" style="display: none">
    <hr/>
    <h3 style="margin-left:20px">Adicionar etapa</h3><br>
    <%= render 'process_steps/form' %>
  </div>
</section>

<script>
  function show_process_steps_form() {
    var target = "#block_process_step_form";
    $(target).show();
    $(window).scrollTop($(target).offset().top);
  }
</script>